<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>보관방법</title>
    

    <!--header css-->
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/header.css' %}">
    <link rel="stylesheet" href="{% static 'css/manage.css' %}">

    <link href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>
    <link href="{% static 'css/write.css' %}" rel="stylesheet">
    <style> nav{ height: 130%;;}</style>
</head>
<body>
    <!--헤더-->
    <header>
        <div>
            <img src="{% static 'img/icon.png' %}">
            <a href="" id="logout">로그아웃</a>
        </div>
    </header>
    <!--네비게이션-->
    <nav class="col-md-2">
        <ul id="menu">
            <!--레시피-->
            <li class="menu-on-off" on-off="off">
                <span class="menu-left">레시피</span>
                <i class="glyphicon glyphicon-chevron-right"></i>
                
            </li>
            <ul class="item-list">
                <li class="menu-item"  value="레시피등록">
                    레시피등록
                </li>
                <li class="menu-item" value="레시피관리">
                    레시피관리
                </li>
            </ul>
            <!--보관방법-->
            <li class="menu-on-off" on-off="on">
                <span class="menu-left">보관방법</span>
                <i class="glyphicon glyphicon-chevron-right"></i>
            </li>
            <ul class="item-list">
                <li class="menu-item" style="color:black; background:white;" value="보관방법작성">
                    보관방법작성
                </li>
                <li class="menu-item" value="보관방법관리">
                    보관방법관리
                </li>
            </ul>
        </ul>
    </nav>
    <!--내용-->
    <div id="content" class="col-md-8">
        <h2 class="text-center">보관방법 작성</h2>
        <form class="storage_form">
            {% csrf_token %}
            <h4>제목</h4>
            <input type="text" id="storageName" class="form-control">
            <h4>재료이미지</h4>
            <input type="file" accept="image/*" id="imgFile" class="upload-file" value="재료이미지 업로드" />
            <label for="imgFile" class="upload-btn">재료 이미지</label>
            <img id="previewImg" src="" />
            <h4>재료보관방법</h4>
            <div class="summernote"></div>
            
            <input type="submit" id="submit" value="작성하기">
            <script>
                $('.storage_form').submit((e) => {
                    e.preventDefault();
                    var storageName = document.getElementById('storageName').value;
                    var storageDoc = document.querySelector('.note-editable').innerText.replace(/(\s*)/g,"");
                    var img = document.getElementById('imgFile').value;
                    if(!img){
                        img = 'non-img.png';
                    }
                    if(!storageName || !storageDoc){
                        alert("제목 또는 내용이 작성되어 있지 않습니다.")
                    }else{
                        
                        $.ajax({
                            type: "post",
                            url: "/manager/write/storage",
                            contentType: false,
                            processData: false,
                            data: {
                                'csrfmiddlewaretoken': '{{ csrf_token }}',
                                'storageName': storageName,
                                'storageDoc': document.querySelector('.note-editable').innerHTML,
                                'storageImg': img,
                            },
                            success: (response) =>{
                                if(response.confirm){
                                    location.replace('/manager/show/storage');
                                }else{
                                    alert('오류발생! \n' + response.msg);
                                }
                            }
                        });
                    }
                });
            </script>
        </form>
        
        <!-- <div id="summernote">Hello Summernote</div> -->

    </div>
    <script src="{% static 'js/manage.js' %}"></script>
    <script src="{% static 'js/write.js' %}"></script>
</body>
</html>